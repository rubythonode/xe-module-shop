<script type="text/javascript">
jQuery(document).ready(function($){
	{$datasourceJS}

	$("#products .product select.level_1").change(function(){
		$first_select = $(this);
		$current_form = $first_select.parent("form");

		$selected_value = $first_select.val();
		$product_srl = $current_form.parent(".product").attr("id").substr(8);

		$second_select = $first_select.next("select.level_2");
		if($second_select.length)
		{
			$options_list = associated_products[$product_srl][$selected_value];
			$second_select.html("");
			$.each($options_list, function(attribute, associated_product_srl){
				$second_select.append("<option value='" + associated_product_srl + "'>" + attribute + "</option>");
			});

			$second_select.trigger("change");
		}
		else
		{
			$associated_product_srl = associated_products[$product_srl][$selected_value];
			$current_form.find("#product_srl").val($associated_product_srl);
		}
	});

	$("#products .product select.level_2").change(function(){
		$current_form = $(this).parent("form");
		$selected_value = $(this).val();

		$current_form.find("#product_srl").val($selected_value);
	});
});


</script>

<!--@if($product->isConfigurable())-->
<!-- Display just first two attributes -->
{@ $max_attributes = 2; $i = 1; }
<!--@foreach($product->configurable_attributes as $attribute_srl => $attribute_title)-->
<!--@if($i > $max_attributes) break; -->
<!--@endif-->

{$attribute_title}
<select id="product_{$product->product_srl}_attribute_{$attribute_srl}_values" class="level_{$i}">
<!-- For first select, also display options -->
<!--@if($i == 1)-->
{@ $already_added = array() }
<!--@foreach($product->associated_products as $asoc_product)-->
{@ $current_value = $asoc_product->attributes[$attribute_srl] }
<!--@if(!$already_added[$current_value])-->
<option value="{$current_value}">{$current_value}</option>
<!--@endif-->
{@ $already_added[$current_value] = true; }
<!--@end-->
<!--@endif-->

</select>
{@ $i++;}
<!--@end-->
<!--@end-->